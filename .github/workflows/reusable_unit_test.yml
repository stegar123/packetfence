name: Reusable unit test
on:
  workflow_call:
    inputs:
      _IMAGE_TYPE:
        required: True
        type: string
      _PACKAGE_NAME:
        required: True
        type: string

jobs:
  unit-test:
    runs-on: packetfence-perl-package-build 
    container:
      image:  ${{ inputs._IMAGE_TYPE == 'rhel8' && 'redhat/ubi8:8.8' || 'debian:11.0'}}
    steps:     
      - name: Download artifactory ${{ inputs._IMAGE_TYPE }}
        uses: actions/download-artifact@v3
        with:
          name: ${{ env.ARTIFACTORY_NAME }}
          path:  /mnt
        env:
          ARTIFACTORY_NAME: ${{ inputs._IMAGE_TYPE == 'rhel8' && 'package-rpm' || 'package-deb' }}

      - name: Install the package packetfence-perl ${{ inputs._IMAGE_TYPE }}
        run: |
          ls -la /mnt
          ${{ inputs._IMAGE_TYPE == 'rhel8' && env.INSTALL_RPM_PACKAGE  || env.INSTALL_DEB_PACKAGE }}
        env:
          INSTALL_RPM_PACKAGE: "set -e && yum -y install findutils && find /mnt -name ${{ inputs._PACKAGE_NAME }}*.rpm -exec rpm -ivh {} \\;"
          INSTALL_DEB_PACKAGE: "set -e && find /mnt -name ${{ inputs._PACKAGE_NAME }}*.deb -exec  bash -c  'dpkg -i {}  &&  apt-get -f install' \\;"
          

